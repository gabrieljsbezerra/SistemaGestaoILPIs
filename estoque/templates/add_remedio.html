{% extends 'base.html' %}
{% load static %}
{% load filters %}

{% block body %}
<div class="container">
    {% if messages %}
    <br>
    {% for message in messages %}
        <div class="alert {{message.tags}}">{{message}}</div>
    {% endfor %}
    {% endif %}
    <h2 class="mb-4">Cadastrar Remédio</h2>
    <form action="{% url 'add_remedio' %}" method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
    {% csrf_token %}

        <div class="mb-3">
          <label for="imagens" class="form-label">Imagens:</label>
          <input class="form-control" type="file" name="imagens" id="imagens" multiple>
        </div>      
        <div class="mb-3">
          <label for="nome" class="form-label">Nome:</label>
          <input class="form-control" type="text" name="nome" id="nome" required>
        </div>      
        <div class="mb-3">
          <label for="categoria" class="form-label">Categoria:</label>
          <select class="form-select" name="categoria" id="categoria" required>
            {% for categoria in categorias %}
              <option value="{{ categoria.id }}">{{ categoria.tipo }}</option>
            {% endfor %}
          </select>
        </div>      
        <div class="mb-3">
          <label for="marca" class="form-label">Marca:</label>
          <input class="form-control" type="text" name="marca" id="marca">
        </div>      
        <div class="mb-3">
          <label for="quantidade" class="form-label">Quantidade:</label>
          <input class="form-control" type="number" name="quantidade" id="quantidade">
        </div>      
        <div class="mb-3">
          <label for="preco_compra" class="form-label">Custo:</label>
          <input class="form-control" type="number" name="preco_compra" id="preco_compra" step="0.01">
        </div>      
        <button type="submit" class="btn btn-success">Salvar</button>
    </form>
    <!-- Lista -->
<!-- Lista de Remédios com Cards -->
<hr class="bg-hr my-4">

<!-- Lista de Remédios -->
<div class="container mt-4">
  <h3 class="mb-4 text-center">Medicamentos Cadastrados</h3>
  <div class="d-flex flex-wrap justify-content-center" style="gap: 16px;">
    {% for remedio in remedios %}
    <div class="card shadow-sm border-0 rounded-3 remedio-card" style="width: 220px; transition: transform 0.3s ease, box-shadow 0.3s ease;">
      <div class="position-relative">
        {% if remedio|get_first_image %}
          <img src="{{ remedio|get_first_image }}" alt="{{ remedio.nome }}" class="card-img-top rounded-top img-fluid remedio-img" style="height: 180px; object-fit: cover;">
        {% else %}
          <img src="{% static 'img/remedio_default.jpg' %}" alt="Imagem não disponível" class="card-img-top rounded-top img-fluid remedio-img" style="height: 180px; object-fit: cover;">
        {% endif %}
      </div>
      <div class="card-body px-3">
        <h6 class="card-title text-truncate fw-bold mb-2">{{ remedio.nome }}</h6>
        <p class="mb-1"><small><strong>Categoria:</strong> {{ remedio.categoria }}</small></p>
        <p class="mb-1"><small><strong>Marca:</strong> {{ remedio.marca }}</small></p>
        <p class="mb-1"><small><strong>Estoque:</strong> {{ remedio.quantidade }}</small></p>
        <p class="mb-2"><small><strong>Custo:</strong> R$ {{ remedio.preco_compra }}</small></p>
        <div class="d-flex justify-content-between">
          <a href="{% url 'editar_remedio' remedio.id %}" class="btn btn-sm btn-outline-primary">
            <i class="bi bi-pencil-square"></i>
          </a>
          <a href="{% url 'excluir_remedio' remedio.id %}" class="btn btn-sm btn-outline-danger">
            <i class="bi bi-trash"></i>
          </a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

{% endblock %}
